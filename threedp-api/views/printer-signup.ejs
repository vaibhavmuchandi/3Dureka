<!DOCTYPE html>
<html lang="en" dir="ltr">
  <%- include('./partials/header.ejs') %>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="https://rawgit.com/bassjobsen/typeahead.js-bootstrap-css/master/typeaheadjs.css" />

  <body class="">
    <div class="container">
      <div class="row">
        <div class="col-sm-9 col-md-7 col-lg-5 mx-auto">
          <div class="card card-signin my-5">
            <div class="card-body">
              <h5 class="card-title text-center">Create an account</h5>

              <div class="form-label">
                <input type="text" id="inputLocation" class="form-control" placeholder="Location" name="location" required autofocus>
                <label for="inputLocation">Location</label>
              </div>

              <form class="form-signin" action="/printer/sign-up" method="POST">
                <div class="form-label-group">
                  <input type="text" id="inputName" class="form-control" placeholder="Name" name="name" required autofocus>
                  <label for="inputName">Name Of Firm</label>
                </div>

                <input type="text" id="coordinates" name="coordinates" hidden>

                <div class="form-label-group">
                  <input type="number" id="inputContact" class="form-control" placeholder="Contact number" name="contact" required autofocus>
                  <label for="inputContact">Contact Number</label>
                </div>


                <div class="form-label-group">
                  <input type="email" id="inputEmail" class="form-control" placeholder="Email address" name="email" required autofocus>
                  <label for="inputEmail">Email address</label>
                </div>


                <div class="form-label-group">
                  <input type="text" id="inputUsername" class="form-control" placeholder="Username" name="username" required autofocus>
                  <label for="inputUsername">Username</label>
                </div>

                <div class="form-label-group">
                  <input type="password" id="inputPassword" class="form-control" placeholder="Password" name="password" required>
                  <label for="inputPassword">Password</label>
                </div>

                <button class="btn btn-lg btn-success btn-block text-uppercase">Sign Up</button>
              </form>
              <div class="form-label-group">
                Already have an account ? <a href="/login">Sign In</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <%- include('./partials/footer.ejs') %>

    <script src="https://rawgit.com/corejavascript/typeahead.js/master/dist/typeahead.bundle.js"></script>
    <script src="https://rawgit.com/komoot/typeahead-address-photon/master/src/typeahead-address-photon.js"></script>

    <script type="text/javascript">
    function formatResult(predictions) {
      let bbox = [68.1113787, 35.6745457, 97.395561, 6.2325274];
      let name = predictions.properties.name;
      let city = predictions.properties.city || '';
      let state = predictions.properties.state || '';
      let country = predictions.properties.country || '';
      let lon = predictions.geometry.coordinates[0];
      let lat = predictions.geometry.coordinates[1];
      if (lon > bbox[0] && lon < bbox[2] && lat < bbox[1] && lat > bbox[3]) {
        if (city != '')
          return `${name}, ${city}, ${state}, ${country}`;
        else if (state != '')
          return `${name}, ${state}, ${country}`;
        else if (country != '')
          return `${name}, ${country}`;
        return `${name}`;
      }
    }

    var engine = new PhotonAddressEngine({
      url: 'https://photon.komoot.de/',
      formatResult: formatResult
    });

    function setCoordinates(event, selected) {
      console.log(selected.geometry.coordinates);
      $('#coordinates').val(selected.geometry.coordinates);
    }

    $('#inputLocation').typeahead({
      hint: true,
      highlight: true,
      minLength: 3
    }, {
      source: engine.ttAdapter(),
      displayKey: 'description'
    });
    engine.bindDefaultTypeaheadEvent($('#inputLocation'));
    $(engine).bind('addresspicker:selected', setCoordinates);
    </script>
  </body>